# خريطة تدفق التطبيق - APP FLOW

## تدفق الصفحات (Routing)

| الصفحة المصدر | الإجراء الذي يقوم به المستخدم | الصفحة الهدف (المسار) | ملاحظات |
|---------------|----------------------------|------------------|----------|
| **الصفحة الرئيسية (/)** | يضغط على زر "المحادثة الذكية" | صفحة المحادثة (/conversation) | انتقال إلى واجهة WhatsApp AI |
| **الصفحة الرئيسية (/)** | يضغط على زر "الأتمتة المرئية" | صفحة منشئ العمليات (/workflow-builder) | فتح منشئ العمليات بالسحب والإفلات |
| **الصفحة الرئيسية (/)** | يضغط على زر "مكتبة التصميم" | صفحة مكتبة التصميم (/design-library) | عرض مكونات UI الجاهزة |
| **الصفحة الرئيسية (/)** | يضغط على زر "الأتمتة المتقدمة" | صفحة الأتمتة المتقدمة (/automation) | ميزات أتمتة متقدمة |
| **شريط التنقل (أي صفحة)** | يضغط على "الرئيسية" | الصفحة الرئيسية (/) | العودة للصفحة الرئيسية |
| **شريط التنقل (أي صفحة)** | يضغط على تبديل اللغة | نفس الصفحة الحالية | تغيير اللغة بين العربية والإنجليزية |
| **شريط التنقل (أي صفحة)** | يضغط على تبديل الوضع | نفس الصفحة الحالية | تبديل بين الوضع الداكن والفاتح |
| **صفحة المحادثة** | يضغط على زر "الرجوع" | الصفحة الرئيسية (/) | العودة من المحادثة للرئيسية |
| **صفحة منشئ العمليات** | يضغط على "حفظ العملية" | نفس الصفحة | حفظ العملية المنشأة |
| **صفحة منشئ العمليات** | يضغط على "تشغيل العملية" | نفس الصفحة | تنفيذ العملية المصممة |
| **صفحة مكتبة التصميم** | يضغط على "معاينة المكون" | نفس الصفحة | فتح معاينة المكون في modal |
| **صفحة مكتبة التصميم** | يضغط على "تحميل المكون" | نفس الصفحة | تحميل ملف المكون |
| **صفحة الأتمتة المتقدمة** | يضغط على "إنشاء أتمتة جديدة" | صفحة منشئ العمليات (/workflow-builder) | انتقال لإنشاء عملية جديدة |

## منطق التفاعلات الديناميكية

| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|

### الصفحة الرئيسية
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **الصفحة الرئيسية** | تمرير الماوس على بطاقات الميزات | ظهور تأثيرات بصرية وتكبير البطاقة | - |
| **الصفحة الرئيسية** | الضغط على "ابدأ مجاناً" | انتقال سلس لصفحة المحادثة الذكية | - |
| **الصفحة الرئيسية** | الضغط على "تعرف على المزيد" | تمرير تلقائي لقسم الميزات | - |

### صفحة المحادثة الذكية
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **المحادثة الذكية** | كتابة رسالة في حقل الإدخال | ظهور مؤشر الكتابة في الوقت الفعلي | - |
| **المحادثة الذكية** | الضغط على زر "إرسال" | إرسال الرسالة وظهور استجابة AI | `aiService.sendMessage()` |
| **المحادثة الذكية** | الضغط على أيقونة المرفقات | فتح نافذة رفع الملفات | `fileService.upload()` |
| **المحادثة الذكية** | الضغط على أيقونة الصوت | بدء تسجيل الرسالة الصوتية | `voiceService.record()` |
| **المحادثة الذكية** | الضغط على رسالة موجودة | عرض تفاصيل الرسالة (توقيت، حالة) | - |
| **المحادثة الذكية** | الضغط على "محادثة جديدة" | إنشاء محادثة فارغة جديدة | `conversationService.create()` |
| **المحادثة الذكية** | البحث في قائمة المحادثات | فلترة المحادثات حسب النص المدخل | - |

### صفحة منشئ العمليات المرئي
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **منشئ العمليات** | سحب عقدة من الشريط الجانبي | إنشاء عقدة جديدة على اللوحة | - |
| **منشئ العمليات** | توصيل عقدتين بالسحب | إنشاء اتصال بين العقدتين | - |
| **منشئ العمليات** | النقر المزدوج على عقدة | فتح نافذة تحرير إعدادات العقدة | - |
| **منشئ العمليات** | الضغط على زر "حفظ" | حفظ العملية في قاعدة البيانات | `workflowService.save()` |
| **منشئ العمليات** | الضغط على زر "تشغيل" | تنفيذ العملية ومراقبة التقدم | `workflowService.execute()` |
| **منشئ العمليات** | الضغط على أداة التكبير/التصغير | تغيير مستوى التكبير للوحة | - |
| **منشئ العمليات** | سحب اللوحة بالماوس | تحريك اللوحة (panning) | - |
| **منشئ العمليات** | الضغط على "تصدير" | تحميل ملف JSON للعملية | `exportService.downloadWorkflow()` |
| **منشئ العمليات** | الضغط على "استيراد" | فتح نافذة رفع ملف العملية | `importService.uploadWorkflow()` |

### صفحة مكتبة التصميم
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **مكتبة التصميم** | البحث في المكونات | فلترة المكونات حسب النص والفئة | - |
| **مكتبة التصميم** | الضغط على فئة معينة | عرض مكونات الفئة المحددة فقط | - |
| **مكتبة التصميم** | الضغط على "معاينة" لمكون | فتح modal لمعاينة المكون | - |
| **مكتبة التصميم** | الضغط على "نسخ الكود" | نسخ كود المكون إلى الحافظة | `clipboardService.copy()` |
| **مكتبة التصميم** | الضغط على "تحميل" | تحميل ملفات المكون | `downloadService.component()` |
| **مكتبة التصميم** | تغيير إعدادات المعاينة | تحديث المعاينة حسب الإعدادات | - |
| **مكتبة التصميم** | الضغط على "إضافة للمفضلة" | حفظ المكون في قائمة المفضلة | `favoritesService.add()` |

### صفحة الأتمتة المتقدمة
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **الأتمتة المتقدمة** | الضغط على "إنشاء أتمتة جديدة" | فتح معالج إنشاء الأتمتة | - |
| **الأتمتة المتقدمة** | الضغط على أتمتة موجودة | عرض تفاصيل الأتمتة وحالتها | `automationService.getDetails()` |
| **الأتمتة المتقدمة** | تشغيل/إيقاف أتمتة | تبديل حالة تشغيل الأتمتة | `automationService.toggle()` |
| **الأتمتة المتقدمة** | الضغط على "تحرير" | فتح الأتمتة في منشئ العمليات | - |
| **الأتمتة المتقدمة** | الضغطط على "حذف" | عرض تأكيد الحذف ثم حذف الأتمتة | `automationService.delete()` |
| **الأتمتة المتقدمة** | عرض سجل التنفيذ | فتح نافذة سجل العمليات المنفذة | `loggingService.getExecutionLog()` |

## التفاعلات العامة (في جميع الصفحات)

| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **أي صفحة** | الضغط على شعار FlowCanvasAI | العودة للصفحة الرئيسية | - |
| **أي صفحة** | الضغط على تبديل اللغة | تغيير جميع النصوص للغة المحددة | `i18nService.changeLanguage()` |
| **أي صفحة** | الضغط على تبديل الوضع (داكن/فاتح) | تغيير مظهر التطبيق بالكامل | `themeService.toggle()` |
| **أي صفحة** | تغيير حجم النافذة | تكيف التطبيق مع الحجم الجديد | - |
| **أي صفحة** | فقدان الاتصال بالإنترنت | ظهور شريط تنبيه بفقدان الاتصال | `networkService.checkConnection()` |
| **أي صفحة** | استعادة الاتصال بالإنترنت | إخفاء شريط التنبيه ومزامنة البيانات | `syncService.synchronize()` |

## حالات خاصة

### حالات التحميل (Loading States)
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **أي صفحة** | تحميل البيانات | عرض skeleton loaders | - |
| **المحادثة** | انتظار رد الـ AI | ظهور مؤشر الكتابة | - |
| **منشئ العمليات** | تنفيذ عملية | شريط تقدم ومؤشرات على العقد | - |

### حالات الأخطاء (Error States)
| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **أي صفحة** | حدوث خطأ في API | عرض رسالة خطأ مع زر "إعادة المحاولة" | `errorService.handleApiError()` |
| **المحادثة** | فشل إرسال رسالة | عرض أيقونة خطأ مع خيار إعادة الإرسال | `retryService.retryMessage()` |
| **منشئ العمليات** | فشل حفظ العملية | عرض تنبيه خطأ مع زر حفظ محلي | `localStorageService.saveBackup()` |

## تدفق المصادقة والأمان

| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **أي صفحة** | انتهاء جلسة المستخدم | إعادة توجيه لصفحة تسجيل الدخول | `authService.redirectToLogin()` |
| **أي صفحة** | محاولة الوصول لميزة مدفوعة | عرض modal للترقية للخطة المدفوعة | `subscriptionService.showUpgrade()` |
| **أي صفحة** | تجاوز حد الاستخدام المجاني | عرض تنبيه بالحد وخيارات الترقية | `quotaService.showLimitReached()` |

## تدفق البيانات في الوقت الفعلي

| في صفحة | عند التفاعل مع عنصر | ماذا يحدث؟ (النتيجة) | الخدمة المطلوبة (إن وجدت) |
|---------|-------------------|---------------------|--------------------------|
| **المحادثة** | وصول رسالة جديدة | ظهور الرسالة فوراً مع تنبيه صوتي | `websocketService.onMessage()` |
| **منشئ العمليات** | تحديث عملية من مستخدم آخر | تحديث العقد المعدلة في الوقت الفعلي | `collaborationService.onUpdate()` |
| **أي صفحة** | تحديث حالة النظام | تحديث مؤشرات الحالة والإشعارات | `statusService.onStatusChange()` |

## إعدادات التخزين المحلي

| المفتاح | القيمة | متى يُحدث | الاستخدام |
|---------|-------|----------|----------|
| `flowcanvas_language` | 'ar' \| 'en' | عند تغيير اللغة | حفظ تفضيل اللغة |
| `flowcanvas_theme` | 'dark' \| 'light' | عند تغيير الوضع | حفظ تفضيل المظهر |
| `flowcanvas_last_page` | string | عند تغيير الصفحة | استعادة آخر صفحة |
| `flowcanvas_workflow_backup` | JSON | عند تحرير العملية | نسخ احتياطية محلية |
| `flowcanvas_user_preferences` | object | عند تغيير الإعدادات | إعدادات المستخدم |

## ملاحظات تطويرية

### للمطورين
1. **مسارات الصفحات**: جميع المسارات تستخدم Next.js App Router
2. **إدارة الحالة**: استخدام React Context لحالة التطبيق العامة
3. **التنقل**: استخدام `useRouter` من Next.js للتنقل البرمجي
4. **التخزين**: `localStorage` للإعدادات المحلية، Firebase للبيانات المزامنة

### للمصممين
1. **الانتقالات**: جميع التفاعلات تحتاج انتقالات سلسة (300ms)
2. **حالات التحميل**: كل عملية تحتاج مؤشر تحميل مناسب
3. **ردود الفعل**: كل نقرة تحتاج تأكيد بصري فوري
4. **إمكانية الوصول**: دعم التنقل بالكيبورد وقارئات الشاشة

### لمديري المنتج
1. **تتبع الاستخدام**: كل تفاعل يُسجل للتحليل
2. **اختبار A/B**: إمكانية اختبار تدفقات مختلفة
3. **تحليل الأداء**: مراقبة أوقات الاستجابة لكل تفاعل
4. **تجربة المستخدم**: تتبع معدلات الإكمال لكل تدفق